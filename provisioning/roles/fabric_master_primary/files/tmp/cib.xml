<cib crm_feature_set="3.0.9" validate-with="pacemaker-2.0" epoch="21" num_updates="0" admin_epoch="0" cib-last-written="Tue May 17 04:54:08 2016" have-quorum="1" dc-uuid="node1">
  <configuration>
    <crm_config>
      <cluster_property_set id="cib-bootstrap-options">
        <nvpair id="cib-bootstrap-options-dc-version" name="dc-version" value="1.1.11-97629de"/>
        <nvpair id="cib-bootstrap-options-cluster-infrastructure" name="cluster-infrastructure" value="classic openais (with plugin)"/>
        <nvpair id="cib-bootstrap-options-expected-quorum-votes" name="expected-quorum-votes" value="1"/>
        <nvpair name="no-quorum-policy" value="ignore" id="cib-bootstrap-options-no-quorum-policy"/>
        <nvpair name="stonith-enabled" value="false" id="cib-bootstrap-options-stonith-enabled"/>
      </cluster_property_set>
    </crm_config>
    <nodes>
      <node id="node1" uname="node1"/>
      <node id="node2" uname="node2"/>
    </nodes>
    <resources>
      <group id="g_mysql">
        <primitive id="p_fs_mysql" class="ocf" provider="heartbeat" type="Filesystem">
          <instance_attributes id="p_fs_mysql-instance_attributes">
            <nvpair name="device" value="/dev/drbd0" id="p_fs_mysql-instance_attributes-device"/>
            <nvpair name="directory" value="/var/lib/mysql-fabric-master" id="p_fs_mysql-instance_attributes-directory"/>
            <nvpair name="fstype" value="ext4" id="p_fs_mysql-instance_attributes-fstype"/>
          </instance_attributes>
        </primitive>
        <primitive id="p_ip_mysql" class="ocf" provider="heartbeat" type="IPaddr2">
          <instance_attributes id="p_ip_mysql-instance_attributes">
            <nvpair name="ip" value="192.168.70.200" id="p_ip_mysql-instance_attributes-ip"/>
            <nvpair name="cidr_netmask" value="24" id="p_ip_mysql-instance_attributes-cidr_netmask"/>
            <nvpair name="nic" value="eth1" id="p_ip_mysql-instance_attributes-nic"/>
          </instance_attributes>
        </primitive>
        <primitive id="p_mysql" class="ocf" provider="heartbeat" type="mysql">
          <instance_attributes id="p_mysql-instance_attributes">
            <nvpair name="binary" value="/usr/sbin/mysqld" id="p_mysql-instance_attributes-binary"/>
            <nvpair name="config" value="/var/lib/mysql-fabric-master/my.cnf" id="p_mysql-instance_attributes-config"/>
            <nvpair name="datadir" value="/var/lib/mysql-fabric-master/data" id="p_mysql-instance_attributes-datadir"/>
            <nvpair name="pid" value="/var/run/mysqld/mysql-fabric-master.pid" id="p_mysql-instance_attributes-pid"/>
            <nvpair name="socket" value="/var/run/mysqld/mysql-fabric-master.sock" id="p_mysql-instance_attributes-socket"/>
            <nvpair name="user" value="mysql" id="p_mysql-instance_attributes-user"/>
            <nvpair name="group" value="mysql" id="p_mysql-instance_attributes-group"/>
            <nvpair name="additional_parameters" value="--bind-address=localhost" id="p_mysql-instance_attributes-additional_parameters"/>
          </instance_attributes>
          <operations>
            <op name="start" timeout="120s" interval="0" id="p_mysql-start-0"/>
            <op name="stop" timeout="120s" interval="0" id="p_mysql-stop-0"/>
            <op name="monitor" interval="20s" timeout="30s" id="p_mysql-monitor-20s"/>
          </operations>
        </primitive>
        <primitive id="p_fabric_mysql" class="ocf" provider="heartbeat" type="mysql-fabric">
          <instance_attributes id="p_fabric_mysql-instance_attributes">
            <nvpair name="binary" value="/usr/bin/mysqlfabric" id="p_fabric_mysql-instance_attributes-binary"/>
            <nvpair name="config" value="/var/lib/mysql-fabric-master/fabric.cfg" id="p_fabric_mysql-instance_attributes-config"/>
          </instance_attributes>
          <operations>
            <op name="start" timeout="120s" interval="0" id="p_fabric_mysql-start-0"/>
            <op name="stop" timeout="120s" interval="0" id="p_fabric_mysql-stop-0"/>
            <op name="monitor" interval="20s" timeout="30s" id="p_fabric_mysql-monitor-20s"/>
          </operations>
        </primitive>
        <meta_attributes id="g_mysql-meta_attributes">
          <nvpair name="target-role" value="Started" id="g_mysql-meta_attributes-target-role"/>
        </meta_attributes>
      </group>
      <master id="ms_drbd_mysql">
        <meta_attributes id="ms_drbd_mysql-meta_attributes">
          <nvpair name="master-max" value="1" id="ms_drbd_mysql-meta_attributes-master-max"/>
          <nvpair name="master-node-max" value="1" id="ms_drbd_mysql-meta_attributes-master-node-max"/>
          <nvpair name="clone-max" value="2" id="ms_drbd_mysql-meta_attributes-clone-max"/>
          <nvpair name="clone-node-max" value="1" id="ms_drbd_mysql-meta_attributes-clone-node-max"/>
          <nvpair name="notify" value="true" id="ms_drbd_mysql-meta_attributes-notify"/>
        </meta_attributes>
        <primitive id="p_drbd_mysql" class="ocf" provider="linbit" type="drbd">
          <instance_attributes id="p_drbd_mysql-instance_attributes">
            <nvpair name="drbd_resource" value="clusterdb" id="p_drbd_mysql-instance_attributes-drbd_resource"/>
          </instance_attributes>
          <operations>
            <op name="start" timeout="120s" interval="0" id="p_drbd_mysql-start-0"/>
            <op name="stop" timeout="120s" interval="0" id="p_drbd_mysql-stop-0"/>
            <op name="monitor" interval="15s" id="p_drbd_mysql-monitor-15s"/>
          </operations>
        </primitive>
      </master>
      <clone id="cl_ping">
        <meta_attributes id="cl_ping-meta_attributes">
          <nvpair name="interleave" value="true" id="cl_ping-meta_attributes-interleave"/>
        </meta_attributes>
        <primitive id="p_ping" class="ocf" provider="pacemaker" type="ping">
          <instance_attributes id="p_ping-instance_attributes">
            <nvpair name="name" value="ping" id="p_ping-instance_attributes-name"/>
            <nvpair name="multiplier" value="1000" id="p_ping-instance_attributes-multiplier"/>
            <nvpair name="host_list" value="192.168.70.1" id="p_ping-instance_attributes-host_list"/>
          </instance_attributes>
          <operations>
            <op name="monitor" interval="15s" timeout="60s" id="p_ping-monitor-15s">
              <instance_attributes id="p_ping-monitor-15s-instance_attributes">
                <nvpair name="start" id="p_ping-monitor-15s-instance_attributes-start"/>
              </instance_attributes>
            </op>
          </operations>
        </primitive>
      </clone>
    </resources>
    <constraints>
      <rsc_colocation id="c_mysql_on_drbd" score="INFINITY" rsc="g_mysql" with-rsc="ms_drbd_mysql" with-rsc-role="Master"/>
      <rsc_location id="l_drbd_master_on_ping" rsc="ms_drbd_mysql">
        <rule role="Master" score="-INFINITY" boolean-op="or" id="l_drbd_master_on_ping-rule">
          <expression attribute="ping" operation="not_defined" id="l_drbd_master_on_ping-rule-expression"/>
          <expression attribute="ping" operation="lte" value="0" type="number" id="l_drbd_master_on_ping-rule-expression-0"/>
        </rule>
      </rsc_location>
      <rsc_order id="o_drbd_before_mysql" score="INFINITY" first="ms_drbd_mysql" first-action="promote" then="g_mysql" then-action="start"/>
    </constraints>
    <rsc_defaults>
      <meta_attributes id="rsc-options">
        <nvpair name="resource-stickiness" value="100" id="rsc-options-resource-stickiness"/>
      </meta_attributes>
    </rsc_defaults>
  </configuration>
</cib>
